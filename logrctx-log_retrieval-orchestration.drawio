<mxfile host="app.diagrams.net" agent="Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/132.0.0.0 Safari/537.36" version="25.0.3">
  <diagram name="Page-1" id="ghS8VhTNqTACfRNLMCYK">
    <mxGraphModel dx="2138" dy="1971" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="1">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="DfFL5rCARnR2TBshgibZ-1" value="Client" style="shape=umlLifeline;perimeter=lifelinePerimeter;whiteSpace=wrap;container=1;dropTarget=0;collapsible=0;recursiveResize=0;outlineConnect=0;portConstraint=eastwest;newEdgeStyle={&quot;edgeStyle&quot;:&quot;elbowEdgeStyle&quot;,&quot;elbow&quot;:&quot;vertical&quot;,&quot;curved&quot;:0,&quot;rounded&quot;:0};size=65;" vertex="1" parent="1">
          <mxGeometry x="123" y="20" width="150" height="1701" as="geometry" />
        </mxCell>
        <mxCell id="DfFL5rCARnR2TBshgibZ-2" value="FastAPI Backend" style="shape=umlLifeline;perimeter=lifelinePerimeter;whiteSpace=wrap;container=1;dropTarget=0;collapsible=0;recursiveResize=0;outlineConnect=0;portConstraint=eastwest;newEdgeStyle={&quot;edgeStyle&quot;:&quot;elbowEdgeStyle&quot;,&quot;elbow&quot;:&quot;vertical&quot;,&quot;curved&quot;:0,&quot;rounded&quot;:0};size=65;" vertex="1" parent="1">
          <mxGeometry x="585" y="20" width="150" height="1701" as="geometry" />
        </mxCell>
        <mxCell id="DfFL5rCARnR2TBshgibZ-3" value="RabbitMQ" style="shape=umlLifeline;perimeter=lifelinePerimeter;whiteSpace=wrap;container=1;dropTarget=0;collapsible=0;recursiveResize=0;outlineConnect=0;portConstraint=eastwest;newEdgeStyle={&quot;edgeStyle&quot;:&quot;elbowEdgeStyle&quot;,&quot;elbow&quot;:&quot;vertical&quot;,&quot;curved&quot;:0,&quot;rounded&quot;:0};size=65;" vertex="1" parent="1">
          <mxGeometry x="935" y="20" width="150" height="1701" as="geometry" />
        </mxCell>
        <mxCell id="DfFL5rCARnR2TBshgibZ-4" value="Worker (50 max)" style="shape=umlLifeline;perimeter=lifelinePerimeter;whiteSpace=wrap;container=1;dropTarget=0;collapsible=0;recursiveResize=0;outlineConnect=0;portConstraint=eastwest;newEdgeStyle={&quot;edgeStyle&quot;:&quot;elbowEdgeStyle&quot;,&quot;elbow&quot;:&quot;vertical&quot;,&quot;curved&quot;:0,&quot;rounded&quot;:0};size=65;" vertex="1" parent="1">
          <mxGeometry x="1275" y="20" width="150" height="1701" as="geometry" />
        </mxCell>
        <mxCell id="DfFL5rCARnR2TBshgibZ-5" value="Loki" style="shape=umlLifeline;perimeter=lifelinePerimeter;whiteSpace=wrap;container=1;dropTarget=0;collapsible=0;recursiveResize=0;outlineConnect=0;portConstraint=eastwest;newEdgeStyle={&quot;edgeStyle&quot;:&quot;elbowEdgeStyle&quot;,&quot;elbow&quot;:&quot;vertical&quot;,&quot;curved&quot;:0,&quot;rounded&quot;:0};size=65;" vertex="1" parent="1">
          <mxGeometry x="1562" y="20" width="150" height="1701" as="geometry" />
        </mxCell>
        <mxCell id="DfFL5rCARnR2TBshgibZ-6" value="" style="points=[];perimeter=orthogonalPerimeter;outlineConnect=0;targetShapes=umlLifeline;portConstraint=eastwest;newEdgeStyle={&quot;edgeStyle&quot;:&quot;elbowEdgeStyle&quot;,&quot;elbow&quot;:&quot;vertical&quot;,&quot;curved&quot;:0,&quot;rounded&quot;:0}" vertex="1" parent="DfFL5rCARnR2TBshgibZ-5">
          <mxGeometry x="70" y="698" width="10" height="48" as="geometry" />
        </mxCell>
        <mxCell id="DfFL5rCARnR2TBshgibZ-7" value="NATS" style="shape=umlLifeline;perimeter=lifelinePerimeter;whiteSpace=wrap;container=1;dropTarget=0;collapsible=0;recursiveResize=0;outlineConnect=0;portConstraint=eastwest;newEdgeStyle={&quot;edgeStyle&quot;:&quot;elbowEdgeStyle&quot;,&quot;elbow&quot;:&quot;vertical&quot;,&quot;curved&quot;:0,&quot;rounded&quot;:0};size=65;" vertex="1" parent="1">
          <mxGeometry x="1762" y="20" width="150" height="1701" as="geometry" />
        </mxCell>
        <mxCell id="DfFL5rCARnR2TBshgibZ-8" value="Drain Algorithm" style="shape=umlLifeline;perimeter=lifelinePerimeter;whiteSpace=wrap;container=1;dropTarget=0;collapsible=0;recursiveResize=0;outlineConnect=0;portConstraint=eastwest;newEdgeStyle={&quot;edgeStyle&quot;:&quot;elbowEdgeStyle&quot;,&quot;elbow&quot;:&quot;vertical&quot;,&quot;curved&quot;:0,&quot;rounded&quot;:0};size=65;" vertex="1" parent="1">
          <mxGeometry x="1962" y="20" width="150" height="1701" as="geometry" />
        </mxCell>
        <mxCell id="DfFL5rCARnR2TBshgibZ-9" value="loop" style="shape=umlFrame;dashed=1;pointerEvents=0;dropTarget=0;strokeColor=#006EAF;height=20;width=40;fillColor=#1ba1e2;fontColor=#ffffff;gradientColor=default;" vertex="1" parent="1">
          <mxGeometry x="645" y="358" width="376" height="131" as="geometry" />
        </mxCell>
        <mxCell id="DfFL5rCARnR2TBshgibZ-10" value="[For each time chunk]" style="text;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;" vertex="1" parent="DfFL5rCARnR2TBshgibZ-9">
          <mxGeometry x="40" width="336" height="20" as="geometry" />
        </mxCell>
        <mxCell id="DfFL5rCARnR2TBshgibZ-11" value="" style="shape=umlFrame;dashed=1;pointerEvents=0;dropTarget=0;strokeColor=#B3B3B3;height=20;width=0" vertex="1" parent="1">
          <mxGeometry x="517" y="192" width="514" height="307" as="geometry" />
        </mxCell>
        <mxCell id="DfFL5rCARnR2TBshgibZ-12" value="" style="text;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;" vertex="1" parent="DfFL5rCARnR2TBshgibZ-11">
          <mxGeometry width="514" height="20" as="geometry" />
        </mxCell>
        <mxCell id="DfFL5rCARnR2TBshgibZ-13" value="loop" style="shape=umlFrame;dashed=1;pointerEvents=0;dropTarget=0;strokeColor=#B3B3B3;height=20;width=40" vertex="1" parent="1">
          <mxGeometry x="999" y="578" width="849" height="294" as="geometry" />
        </mxCell>
        <mxCell id="DfFL5rCARnR2TBshgibZ-14" value="[Until queue empty]" style="text;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;" vertex="1" parent="DfFL5rCARnR2TBshgibZ-13">
          <mxGeometry x="40" width="809" height="20" as="geometry" />
        </mxCell>
        <mxCell id="DfFL5rCARnR2TBshgibZ-15" value="" style="shape=umlFrame;dashed=1;pointerEvents=0;dropTarget=0;strokeColor=#B3B3B3;height=20;width=0" vertex="1" parent="1">
          <mxGeometry x="989" y="509" width="869" height="373" as="geometry" />
        </mxCell>
        <mxCell id="DfFL5rCARnR2TBshgibZ-16" value="" style="text;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;" vertex="1" parent="DfFL5rCARnR2TBshgibZ-15">
          <mxGeometry width="869" height="20" as="geometry" />
        </mxCell>
        <mxCell id="DfFL5rCARnR2TBshgibZ-17" value="loop" style="shape=umlFrame;dashed=1;pointerEvents=0;dropTarget=0;strokeColor=#B3B3B3;height=20;width=40" vertex="1" parent="1">
          <mxGeometry x="187" y="1009" width="1936" height="305" as="geometry" />
        </mxCell>
        <mxCell id="DfFL5rCARnR2TBshgibZ-18" value="[For each NATS message]" style="text;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;" vertex="1" parent="DfFL5rCARnR2TBshgibZ-17">
          <mxGeometry x="40" width="1896" height="20" as="geometry" />
        </mxCell>
        <mxCell id="DfFL5rCARnR2TBshgibZ-19" value="" style="shape=umlFrame;dashed=1;pointerEvents=0;dropTarget=0;strokeColor=#B3B3B3;height=20;width=0" vertex="1" parent="1">
          <mxGeometry x="177" y="892" width="1956" height="432" as="geometry" />
        </mxCell>
        <mxCell id="DfFL5rCARnR2TBshgibZ-20" value="" style="text;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;" vertex="1" parent="DfFL5rCARnR2TBshgibZ-19">
          <mxGeometry width="1956" height="20" as="geometry" />
        </mxCell>
        <mxCell id="DfFL5rCARnR2TBshgibZ-21" value="" style="shape=umlFrame;dashed=1;pointerEvents=0;dropTarget=0;strokeColor=#B3B3B3;height=20;width=0" vertex="1" parent="1">
          <mxGeometry x="163" y="1383" width="1909" height="243" as="geometry" />
        </mxCell>
        <mxCell id="DfFL5rCARnR2TBshgibZ-22" value="" style="text;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;" vertex="1" parent="DfFL5rCARnR2TBshgibZ-21">
          <mxGeometry width="1909" height="20" as="geometry" />
        </mxCell>
        <mxCell id="DfFL5rCARnR2TBshgibZ-23" value="GET /api/logs?timeRange=5m&amp;query={service=&quot;app&quot;}" style="verticalAlign=bottom;edgeStyle=elbowEdgeStyle;elbow=vertical;curved=0;rounded=0;endArrow=block;" edge="1" parent="1" source="DfFL5rCARnR2TBshgibZ-1" target="DfFL5rCARnR2TBshgibZ-2">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="436" y="172" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="DfFL5rCARnR2TBshgibZ-24" value="Calculate chunks based on time range&#xa;(~1000 logs per chunk)" style="curved=1;endArrow=block;rounded=0;" edge="1" parent="1" source="DfFL5rCARnR2TBshgibZ-2" target="DfFL5rCARnR2TBshgibZ-2">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="715" y="308" />
              <mxPoint x="715" y="338" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="DfFL5rCARnR2TBshgibZ-25" value="Publish task&#xa;{&quot;start_time&quot;: &quot;t1&quot;, &quot;end_time&quot;: &quot;t2&quot;,&#xa;&quot;query&quot;: &quot;query&quot;, &quot;request_id&quot;: &quot;uuid&quot;}" style="verticalAlign=bottom;edgeStyle=elbowEdgeStyle;elbow=vertical;curved=0;rounded=0;endArrow=block;" edge="1" parent="1" source="DfFL5rCARnR2TBshgibZ-2" target="DfFL5rCARnR2TBshgibZ-3">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="846" y="469" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="DfFL5rCARnR2TBshgibZ-26" value="Dequeue task (prefetch=5)" style="verticalAlign=bottom;edgeStyle=elbowEdgeStyle;elbow=vertical;curved=0;rounded=0;endArrow=block;" edge="1" parent="1" source="DfFL5rCARnR2TBshgibZ-3" target="DfFL5rCARnR2TBshgibZ-4">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1189" y="651" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="DfFL5rCARnR2TBshgibZ-27" value="Query logs&#xa;POST /loki/api/v1/query_range" style="verticalAlign=bottom;edgeStyle=elbowEdgeStyle;elbow=vertical;curved=0;rounded=0;endArrow=block;" edge="1" parent="1" source="DfFL5rCARnR2TBshgibZ-4" target="DfFL5rCARnR2TBshgibZ-6">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1500" y="718" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="DfFL5rCARnR2TBshgibZ-28" value="Return logs (max 1000)" style="verticalAlign=bottom;edgeStyle=elbowEdgeStyle;elbow=vertical;curved=0;rounded=0;dashed=1;dashPattern=2 3;endArrow=block;" edge="1" parent="1" source="DfFL5rCARnR2TBshgibZ-6" target="DfFL5rCARnR2TBshgibZ-4">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1503" y="766" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="DfFL5rCARnR2TBshgibZ-29" value="Publish to NATS&#xa;Subject: logs.{request_id}&#xa;Payload: Compressed logs" style="verticalAlign=bottom;edgeStyle=elbowEdgeStyle;elbow=vertical;curved=0;rounded=0;endArrow=block;" edge="1" parent="1" source="DfFL5rCARnR2TBshgibZ-4" target="DfFL5rCARnR2TBshgibZ-7">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1602" y="852" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="DfFL5rCARnR2TBshgibZ-30" value="Subscribe: logs.{request_id}" style="verticalAlign=bottom;edgeStyle=elbowEdgeStyle;elbow=vertical;curved=0;rounded=0;endArrow=block;" edge="1" parent="1" source="DfFL5rCARnR2TBshgibZ-7" target="DfFL5rCARnR2TBshgibZ-2">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1262" y="989" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="DfFL5rCARnR2TBshgibZ-31" value="Buffer logs (batch ~50k)" style="verticalAlign=bottom;edgeStyle=elbowEdgeStyle;elbow=vertical;curved=0;rounded=0;endArrow=block;" edge="1" parent="1" source="DfFL5rCARnR2TBshgibZ-2" target="DfFL5rCARnR2TBshgibZ-8">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1359" y="1082" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="DfFL5rCARnR2TBshgibZ-32" value="Group similar logs" style="curved=1;endArrow=block;rounded=0;" edge="1" parent="1" source="DfFL5rCARnR2TBshgibZ-8" target="DfFL5rCARnR2TBshgibZ-8">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="2088" y="1130" />
              <mxPoint x="2088" y="1160" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="DfFL5rCARnR2TBshgibZ-33" value="Return reduced logs" style="verticalAlign=bottom;edgeStyle=elbowEdgeStyle;elbow=vertical;curved=0;rounded=0;endArrow=block;" edge="1" parent="1" source="DfFL5rCARnR2TBshgibZ-8" target="DfFL5rCARnR2TBshgibZ-2">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1362" y="1208" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="DfFL5rCARnR2TBshgibZ-34" value="Stream via SSE&#xa;event: logs&#xa;data: {processed logs}" style="verticalAlign=bottom;edgeStyle=elbowEdgeStyle;elbow=vertical;curved=0;rounded=0;endArrow=block;" edge="1" parent="1" source="DfFL5rCARnR2TBshgibZ-2" target="DfFL5rCARnR2TBshgibZ-1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="439" y="1294" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="DfFL5rCARnR2TBshgibZ-35" value="If query fails: Message back to queue" style="verticalAlign=bottom;edgeStyle=elbowEdgeStyle;elbow=vertical;curved=0;rounded=0;dashed=1;dashPattern=2 3;endArrow=block;" edge="1" parent="1" source="DfFL5rCARnR2TBshgibZ-4" target="DfFL5rCARnR2TBshgibZ-3">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1192" y="1480" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="DfFL5rCARnR2TBshgibZ-36" value="Exponential backoff for Loki errors" style="curved=1;dashed=1;dashPattern=2 3;endArrow=block;rounded=0;" edge="1" parent="1" source="DfFL5rCARnR2TBshgibZ-4" target="DfFL5rCARnR2TBshgibZ-4">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1401" y="1528" />
              <mxPoint x="1401" y="1558" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="DfFL5rCARnR2TBshgibZ-37" value="SSE heartbeat every 30s" style="verticalAlign=bottom;edgeStyle=elbowEdgeStyle;elbow=vertical;curved=0;rounded=0;dashed=1;dashPattern=2 3;endArrow=block;" edge="1" parent="1" source="DfFL5rCARnR2TBshgibZ-2" target="DfFL5rCARnR2TBshgibZ-1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="439" y="1606" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="DfFL5rCARnR2TBshgibZ-38" value="Complete Request Lifecycle" style="fillColor=#ffff88;strokeColor=#9E916F;" vertex="1" parent="1">
          <mxGeometry x="173" y="95" width="1889" height="49" as="geometry" />
        </mxCell>
        <mxCell id="DfFL5rCARnR2TBshgibZ-39" value="Chunk Creation Phase" style="fillColor=#ffff88;strokeColor=#9E916F;" vertex="1" parent="1">
          <mxGeometry x="570" y="212" width="181" height="49" as="geometry" />
        </mxCell>
        <mxCell id="DfFL5rCARnR2TBshgibZ-40" value="Worker Processing (Max 50 concurrent)" style="fillColor=#ffff88;strokeColor=#9E916F;" vertex="1" parent="1">
          <mxGeometry x="1196" y="529" width="309" height="49" as="geometry" />
        </mxCell>
        <mxCell id="DfFL5rCARnR2TBshgibZ-41" value="Log Processing &amp; Streaming" style="fillColor=#ffff88;strokeColor=#9E916F;" vertex="1" parent="1">
          <mxGeometry x="548" y="912" width="225" height="49" as="geometry" />
        </mxCell>
        <mxCell id="DfFL5rCARnR2TBshgibZ-42" value="Process completes when all chunks processed" style="fillColor=#ffff88;strokeColor=#9E916F;" vertex="1" parent="1">
          <mxGeometry x="20" y="1334" width="357" height="49" as="geometry" />
        </mxCell>
        <mxCell id="DfFL5rCARnR2TBshgibZ-43" value="Error Handling" style="fillColor=#ffff88;strokeColor=#9E916F;" vertex="1" parent="1">
          <mxGeometry x="173" y="1403" width="1889" height="49" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
